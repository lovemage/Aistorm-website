<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram è¯Šæ–­å·¥å…· - AIStorm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.success { background: #28a745; }
        .button.warning { background: #ffc107; color: #212529; }
        .button.danger { background: #dc3545; }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .warning { border-color: #ffc107; background: #fff3cd; }
        .info { border-color: #17a2b8; background: #d1ecf1; }
        .step {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #2196f3;
            margin: 10px 0;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .status-item {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .status-ok { background: #d4edda; border: 1px solid #c3e6cb; }
        .status-error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .status-warning { background: #fff3cd; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>ğŸ¤– Telegram Bot è¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
        <h2>ğŸ“Š Telegram åŠŸèƒ½çŠ¶æ€</h2>
        <div class="info result">
            <strong>âœ… Telegram åŠŸèƒ½å·²å®Œå…¨å®ç°ï¼</strong>
            <br><br>å®ç°çš„åŠŸèƒ½åŒ…æ‹¬ï¼š
            <br>â€¢ æ”¯ä»˜æˆåŠŸé€šçŸ¥ (OxaPay Webhook)
            <br>â€¢ è®¢å•åˆ›å»ºé€šçŸ¥
            <br>â€¢ æ”¯ä»˜å¤±è´¥é€šçŸ¥
            <br>â€¢ è®¢å•çŠ¶æ€æ›´æ–°é€šçŸ¥
            <br>â€¢ é…ç½®æ£€æŸ¥å’Œæµ‹è¯•æ¥å£
            <br><br><strong>å¦‚æœæ”¶ä¸åˆ°é€šçŸ¥ï¼Œé€šå¸¸æ˜¯é…ç½®é—®é¢˜ï¼Œè€Œä¸æ˜¯ä»£ç é—®é¢˜ã€‚</strong>
        </div>
        
        <button class="button" onclick="checkTelegramStatus()">æ£€æŸ¥ Telegram çŠ¶æ€</button>
        <div id="statusResult" class="result"></div>
    </div>

    <div class="section">
        <h2>ğŸ”§ é…ç½®æ£€æŸ¥</h2>
        <p>æ£€æŸ¥åç«¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼š</p>
        <button class="button" onclick="checkConfiguration()">æ£€æŸ¥é…ç½®</button>
        <div id="configResult" class="result"></div>
    </div>

    <div class="section">
        <h2>ğŸ“¨ å‘é€æµ‹è¯•æ¶ˆæ¯</h2>
        <p>æµ‹è¯• Telegram Bot æ˜¯å¦èƒ½æ­£å¸¸å‘é€æ¶ˆæ¯ï¼š</p>
        <div style="margin: 10px 0;">
            <button class="button" onclick="sendTestMessage('test')">å‘é€åŸºç¡€æµ‹è¯•æ¶ˆæ¯</button>
            <button class="button warning" onclick="sendTestMessage('config')">å‘é€é…ç½®ä¿¡æ¯</button>
            <button class="button success" onclick="sendTestMessage('payment')">æ¨¡æ‹Ÿæ”¯ä»˜é€šçŸ¥</button>
        </div>
        <div id="testResult" class="result"></div>
    </div>

    <div class="section">
        <h2>ğŸ” é—®é¢˜è¯Šæ–­æŒ‡å—</h2>
        
        <div class="step">
            <h4>æ­¥éª¤ 1: éªŒè¯ Bot Token</h4>
            <p>ç¡®ä¿æ‚¨çš„ Bot Token æ­£ç¡®ä¸”æœ‰æ•ˆã€‚</p>
            <div class="code">
# æ£€æŸ¥æ–¹æ³•ï¼š
curl -X GET "https://api.telegram.org/bot YOUR_BOT_TOKEN/getMe"

# æ­£ç¡®å“åº”ç¤ºä¾‹ï¼š
{
  "ok": true,
  "result": {
    "id": 123456789,
    "is_bot": true,
    "first_name": "Your Bot Name",
    "username": "your_bot_username"
  }
}
            </div>
        </div>

        <div class="step">
            <h4>æ­¥éª¤ 2: éªŒè¯ Chat ID</h4>
            <p>ç¡®ä¿ Chat ID æ­£ç¡®ï¼Œå¯ä»¥æ˜¯ä¸ªäººèŠå¤©æˆ–ç¾¤ç»„ IDã€‚</p>
            <div class="code">
# è·å– Chat ID çš„æ–¹æ³•ï¼š
# 1. å‘ Bot å‘é€æ¶ˆæ¯ /start
# 2. è®¿é—®: https://api.telegram.org/bot YOUR_BOT_TOKEN/getUpdates
# 3. åœ¨å“åº”ä¸­æ‰¾åˆ° "chat": {"id": -123456789}

# ç¾¤ç»„ ID é€šå¸¸æ˜¯è´Ÿæ•°
# ä¸ªäººèŠå¤© ID é€šå¸¸æ˜¯æ­£æ•°
            </div>
        </div>

        <div class="step">
            <h4>æ­¥éª¤ 3: ç¯å¢ƒå˜é‡é…ç½®</h4>
            <p>ç¡®ä¿åœ¨æœåŠ¡å™¨ä¸Šæ­£ç¡®è®¾ç½®äº†ç¯å¢ƒå˜é‡ã€‚</p>
            <div class="code">
# åœ¨ .env æ–‡ä»¶ä¸­æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼š
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=-1001234567890
OXAPAY_SECRET_KEY=your_oxapay_secret_key

# æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆï¼š
echo $TELEGRAM_BOT_TOKEN
echo $TELEGRAM_CHAT_ID
echo $OXAPAY_SECRET_KEY
            </div>
        </div>

        <div class="step">
            <h4>æ­¥éª¤ 4: æƒé™æ£€æŸ¥</h4>
            <p>ç¡®ä¿ Bot æœ‰å‘é€æ¶ˆæ¯çš„æƒé™ã€‚</p>
            <ul>
                <li>âœ… Bot å¿…é¡»åœ¨ç¾¤ç»„ä¸­ï¼ˆå¦‚æœä½¿ç”¨ç¾¤ç»„ IDï¼‰</li>
                <li>âœ… Bot å¿…é¡»æœ‰å‘é€æ¶ˆæ¯æƒé™</li>
                <li>âœ… ç¾¤ç»„è®¾ç½®å…è®¸ Bot å‘é€æ¶ˆæ¯</li>
                <li>âœ… æ‚¨å·²ç»ä¸ Bot å¼€å§‹è¿‡å¯¹è¯ï¼ˆå¦‚æœæ˜¯ç§èŠï¼‰</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2>
        
        <div class="warning result">
            <strong>é—®é¢˜ 1: æ”¶ä¸åˆ°ä»»ä½•é€šçŸ¥</strong>
            <br>â€¢ æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
            <br>â€¢ éªŒè¯ Bot Token å’Œ Chat ID æ˜¯å¦æœ‰æ•ˆ
            <br>â€¢ ç¡®ä¿ Bot å·²æ·»åŠ åˆ°ç¾¤ç»„æˆ–å·²å¼€å§‹ç§èŠ
            <br>â€¢ æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œæ˜¯å¦èƒ½è®¿é—® Telegram API
        </div>

        <div class="warning result">
            <strong>é—®é¢˜ 2: æµ‹è¯•æ¶ˆæ¯å¯ä»¥æ”¶åˆ°ï¼Œä½†æ”¯ä»˜é€šçŸ¥æ”¶ä¸åˆ°</strong>
            <br>â€¢ æ£€æŸ¥ OxaPay Webhook URL æ˜¯å¦æ­£ç¡®é…ç½®
            <br>â€¢ éªŒè¯ OxaPay è´¦æˆ·çš„ Webhook è®¾ç½®
            <br>â€¢ æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
            <br>â€¢ ç¡®è®¤è®¢å•çŠ¶æ€æ˜¯å¦æ­£ç¡®æ›´æ–°
        </div>

        <div class="warning result">
            <strong>é—®é¢˜ 3: é—´æ­‡æ€§æ”¶ä¸åˆ°é€šçŸ¥</strong>
            <br>â€¢ æ£€æŸ¥ Telegram API é€Ÿç‡é™åˆ¶
            <br>â€¢ éªŒè¯æœåŠ¡å™¨ç¨³å®šæ€§å’Œç½‘ç»œè¿æ¥
            <br>â€¢ æŸ¥çœ‹æ˜¯å¦æœ‰é‡å¤æ¶ˆæ¯è¢«è¿‡æ»¤
            <br>â€¢ æ£€æŸ¥æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤</h2>
        <ol>
            <li><strong>æ£€æŸ¥é…ç½®</strong>ï¼šç‚¹å‡»"æ£€æŸ¥é…ç½®"æŒ‰é’®</li>
            <li><strong>å‘é€æµ‹è¯•æ¶ˆæ¯</strong>ï¼šç‚¹å‡»"å‘é€åŸºç¡€æµ‹è¯•æ¶ˆæ¯"</li>
            <li><strong>åˆ›å»ºæµ‹è¯•è®¢å•</strong>ï¼šè®¿é—® <code>test_invoice_api.html</code> åˆ›å»ºæµ‹è¯•è®¢å•</li>
            <li><strong>è§¦å‘æ”¯ä»˜é€šçŸ¥</strong>ï¼šå®Œæˆæ”¯ä»˜æµç¨‹æŸ¥çœ‹æ˜¯å¦æ”¶åˆ°é€šçŸ¥</li>
            <li><strong>æ£€æŸ¥æ—¥å¿—</strong>ï¼šæŸ¥çœ‹æœåŠ¡å™¨åç«¯æ—¥å¿—è¾“å‡º</li>
        </ol>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api';

        async function checkTelegramStatus() {
            const result = document.getElementById('statusResult');
            try {
                result.textContent = 'æ­£åœ¨æ£€æŸ¥ Telegram çŠ¶æ€...';
                
                const response = await fetch(`${API_BASE}/test-telegram`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: 'config' })
                });
                
                const data = await response.json();
                
                let statusHtml = '<div class="status-grid">';
                statusHtml += `<div class="status-item ${data.bot_configured ? 'status-ok' : 'status-error'}">`;
                statusHtml += `<strong>Bot é…ç½®</strong><br>${data.bot_configured ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}`;
                statusHtml += '</div>';
                
                statusHtml += `<div class="status-item ${data.chat_id_configured ? 'status-ok' : 'status-error'}">`;
                statusHtml += `<strong>Chat ID</strong><br>${data.chat_id_configured ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}`;
                statusHtml += '</div>';
                
                statusHtml += `<div class="status-item ${data.success ? 'status-ok' : 'status-error'}">`;
                statusHtml += `<strong>å‘é€æµ‹è¯•</strong><br>${data.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`;
                statusHtml += '</div>';
                statusHtml += '</div>';
                
                statusHtml += `\n\nè¯¦ç»†ä¿¡æ¯:\n${JSON.stringify(data, null, 2)}`;
                
                result.innerHTML = statusHtml;
                result.className = `result ${data.success ? 'success' : 'error'}`;
                
            } catch (error) {
                result.textContent = `âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        async function checkConfiguration() {
            const result = document.getElementById('configResult');
            try {
                result.textContent = 'æ­£åœ¨æ£€æŸ¥é…ç½®...';
                
                const response = await fetch(`${API_BASE}/test-telegram`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: 'config' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.textContent = `âœ… é…ç½®æ£€æŸ¥å®Œæˆï¼\n\nå¦‚æœæ‚¨æ”¶åˆ°äº† Telegram æ¶ˆæ¯ï¼Œè¯´æ˜é…ç½®æ­£ç¡®ã€‚\nå¦‚æœæ²¡æœ‰æ”¶åˆ°ï¼Œè¯·æ£€æŸ¥ï¼š\n1. Bot Token æ˜¯å¦æ­£ç¡®\n2. Chat ID æ˜¯å¦æ­£ç¡®\n3. Bot æ˜¯å¦æœ‰å‘é€æƒé™\n\nè¯¦ç»†å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    result.className = 'result success';
                } else {
                    result.textContent = `âŒ é…ç½®æ£€æŸ¥å‘ç°é—®é¢˜:\n\n${data.message || 'æœªçŸ¥é”™è¯¯'}\n\nè¯¦ç»†å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    result.className = 'result error';
                }
                
            } catch (error) {
                result.textContent = `âŒ é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        async function sendTestMessage(type) {
            const result = document.getElementById('testResult');
            try {
                result.textContent = `æ­£åœ¨å‘é€${type}æµ‹è¯•æ¶ˆæ¯...`;
                
                let messageData = { type: type };
                
                if (type === 'payment') {
                    messageData.message = `ğŸ’° <b>æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸé€šçŸ¥</b>

ğŸ“¦ <b>äº§å“ï¼š</b>ChatGPT Pro è´¦å·
ğŸ”¢ <b>æ•°é‡ï¼š</b>1 æœˆ
ğŸ’µ <b>é‡‘é¢ï¼š</b>$29.99 USDT
ğŸ“§ <b>é‚®ç®±ï¼š</b>test@aistorm.art
ğŸ†” <b>è®¢å•å·ï¼š</b><code>order_test_${Date.now()}</code>
ğŸ“Š <b>çŠ¶æ€ï¼š</b>æ”¯ä»˜æˆåŠŸ
â° <b>æ—¶é—´ï¼š</b>${new Date().toLocaleString('zh-CN')}

ğŸ’³ <b>æ”¯ä»˜æ–¹å¼ï¼š</b>USDTæ”¯ä»˜
ğŸ” <b>è¿½è¸ªIDï¼š</b><code>test_track_${Date.now()}</code>

ğŸ‰ <b>è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ï¼</b>`;
                }
                
                const response = await fetch(`${API_BASE}/test-telegram`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(messageData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.textContent = `âœ… ${type}æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸï¼\n\nè¯·æ£€æŸ¥æ‚¨çš„ Telegram æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ã€‚\n\nå¦‚æœæ”¶åˆ°äº†ï¼Œè¯´æ˜ Telegram é…ç½®å®Œå…¨æ­£å¸¸ï¼\nå¦‚æœæ²¡æ”¶åˆ°ï¼Œè¯·æ£€æŸ¥ Bot æƒé™å’Œé…ç½®ã€‚\n\næœåŠ¡å™¨å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    result.className = 'result success';
                } else {
                    result.textContent = `âŒ æµ‹è¯•æ¶ˆæ¯å‘é€å¤±è´¥:\n\n${data.message || data.error}\n\nè¯·æ£€æŸ¥ï¼š\n1. TELEGRAM_BOT_TOKEN æ˜¯å¦æ­£ç¡®\n2. TELEGRAM_CHAT_ID æ˜¯å¦æ­£ç¡®\n3. Bot æ˜¯å¦æœ‰å‘é€æ¶ˆæ¯æƒé™\n\næœåŠ¡å™¨å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    result.className = 'result error';
                }
                
            } catch (error) {
                result.textContent = `âŒ æµ‹è¯•æ¶ˆæ¯å‘é€å¼‚å¸¸: ${error.message}`;
                result.className = 'result error';
            }
        }

        // é¡µé¢åŠ è½½æç¤º
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (confirm('Telegram è¯Šæ–­å·¥å…·å·²åŠ è½½ï¼\n\nè¿™ä¸ªå·¥å…·å°†å¸®åŠ©æ‚¨ï¼š\nâœ… æ£€æŸ¥ Telegram é…ç½®çŠ¶æ€\nâœ… å‘é€æµ‹è¯•æ¶ˆæ¯\nâœ… è¯Šæ–­å¸¸è§é—®é¢˜\n\næ˜¯å¦ç«‹å³å¼€å§‹æ£€æŸ¥ Telegram çŠ¶æ€ï¼Ÿ')) {
                    checkTelegramStatus();
                }
            }, 1000);
        });
    </script>
</body>
</html> 